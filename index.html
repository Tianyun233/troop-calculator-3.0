<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bear Trap Calculator V4.0</title>
    <style>
        body { font-family: 'Segoe UI', Arial, sans-serif; background-color: #f0f2f5; color: #333; padding: 20px; max-width: 850px; margin: 0 auto; }
        .card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); margin-bottom: 20px; }
        h1 { text-align: center; color: #1a2a3a; border-bottom: 3px solid #e67e22; padding-bottom: 10px; }
        .section-title { font-weight: bold; margin-bottom: 20px; color: #2c3e50; font-size: 1.2em; display: flex; align-items: center; }
        .input-group { display: flex; gap: 20px; margin-bottom: 15px; align-items: center; flex-wrap: wrap; }
        .input-group label { font-weight: 600; min-width: 140px; }
        input[type="number"], select { padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 1rem; }
        .checkbox-group { display: flex; gap: 25px; margin: 20px 0; padding: 15px; background: #fff9f0; border-radius: 8px; }
        .checkbox-item { display: flex; align-items: center; cursor: pointer; font-weight: 600; }
        .checkbox-item input { margin-right: 10px; width: 18px; height: 18px; }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th, td { padding: 12px; text-align: center; border-bottom: 1px solid #eee; }
        th { background-color: #f8f9fa; color: #666; }
        .btn-calc { width: 100%; padding: 18px; background: linear-gradient(135deg, #e67e22, #d35400); color: white; border: none; border-radius: 8px; font-size: 1.1em; font-weight: bold; cursor: pointer; transition: 0.2s; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .btn-calc:hover { transform: translateY(-2px); box-shadow: 0 6px 12px rgba(0,0,0,0.15); }
        #result-area { display: none; margin-top: 20px; border: 2px solid #e67e22; }
        .result-row { display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid #eee; font-size: 1.15em; }
        .result-highlight { font-weight: bold; color: #e67e22; font-size: 1.2em; }
        .lang-container { text-align: right; margin-bottom: 15px; }
    </style>
</head>
<body>

    <div class="lang-container">
        <select id="langSelector" onchange="changeLanguage(this.value)">
            <option value="zh-CN">ç®€ä½“ä¸­æ–‡</option>
            <option value="en">English</option>
        </select>
    </div>

    <h1 data-i18n="title">ğŸ» æ‰“ç†Šé…å…µæ¯”ä¾‹è®¡ç®—å™¨ V4.0</h1>

    <div class="card">
        <div class="section-title" data-i18n="config_title">ğŸ› ï¸ åŸºç¡€é…ç½®</div>
        
        <div class="input-group">
            <label data-i18n="label_capacity">å‡ºå¾å®¹é‡ï¼š</label>
            <input type="number" id="totalCapacity" value="160000" step="1000">
        </div>

        <div class="input-group">
            <label data-i18n="label_tier">é»„é‡‘æŠ€èƒ½é˜¶æ®µï¼š</label>
            <select id="heroTier" style="min-width: 220px;">
                <option value="none" data-i18n="opt_none">æ™®é€š (ä½äºé»„é‡‘3)</option>
                <option value="g3" data-i18n="opt_g3">é»„é‡‘ 3 (1.1x å¢ä¼¤)</option>
                <option value="g5" data-i18n="opt_g5">é»„é‡‘ 5 (1.15x å¢ä¼¤)</option>
                <option value="g8" data-i18n="opt_g8">é»„é‡‘ 8 (å¼“å…µ 1.225x + 4%æ”»)</option>
            </select>
        </div>

        <div class="checkbox-group">
            <label class="checkbox-item">
                <input type="checkbox" id="useRosa"> 
                <span data-i18n="label_rosa">ä½¿ç”¨ç½—è (å¼“å…µæ”»å‡»x1.3)</span>
            </label>
            <label class="checkbox-item">
                <input type="checkbox" id="useShieldLimit" checked> 
                <span data-i18n="label_shield_limit">ç›¾å…µçº¦æŸ (è‡³å°‘5,000)</span>
            </label>
        </div>
    </div>

    <div class="card">
        <div class="section-title" data-i18n="stats_title">ğŸ“ˆ ç©å®¶ä¸ªäººåŠ æˆ (x%)</div>
        <table>
            <thead>
                <tr>
                    <th data-i18n="th_troop">å…µç§</th>
                    <th data-i18n="th_buff_atk">åŠ æˆæ”» (%)</th>
                    <th data-i18n="th_buff_leth">åŠ æˆæ€ (%)</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td data-i18n="troop_inf">ğŸ›¡ï¸ ç›¾å…µ</td>
                    <td><input type="number" id="inf_atk" value="500"></td>
                    <td><input type="number" id="inf_leth" value="500"></td>
                </tr>
                <tr>
                    <td data-i18n="troop_rid">ğŸ éª‘å…µ</td>
                    <td><input type="number" id="rid_atk" value="500"></td>
                    <td><input type="number" id="rid_leth" value="500"></td>
                </tr>
                <tr>
                    <td data-i18n="troop_hun">ğŸ¹ å¼“å…µ</td>
                    <td><input type="number" id="hun_atk" value="500"></td>
                    <td><input type="number" id="hun_leth" value="500"></td>
                </tr>
            </tbody>
        </table>

        <button class="btn-calc" onclick="calculate()" style="margin-top: 25px;" data-i18n="btn_calc">ç”Ÿæˆè®¡ç®—ç»“æœ</button>
    </div>

    <div class="card" id="result-area">
        <div class="section-title" data-i18n="result_title">ğŸ“Š æ¨èé…å…µæ–¹æ¡ˆ</div>
        <div id="result-content"></div>
    </div>

    <script>
        const translations = {
            "zh-CN": {
                title: "ğŸ» æ‰“ç†Šé…å…µæ¯”ä¾‹è®¡ç®—å™¨ V4.0",
                config_title: "ğŸ› ï¸ åŸºç¡€é…ç½®",
                label_capacity: "å‡ºå¾å®¹é‡ï¼š",
                label_tier: "é»„é‡‘æŠ€èƒ½é˜¶æ®µï¼š",
                label_rosa: "ä½¿ç”¨ç½—è (å¼“å…µæ”»å‡»x1.3)",
                label_shield_limit: "ç›¾å…µçº¦æŸ (è‡³å°‘5,000)",
                opt_none: "æ™®é€š / ä½äºé»„é‡‘3",
                opt_g3: "é»„é‡‘ 3 (1.1x å¢ä¼¤)",
                opt_g5: "é»„é‡‘ 5 (1.15x å¢ä¼¤)",
                opt_g8: "é»„é‡‘ 8 (å¼“å…µç‰¹å¼º)",
                stats_title: "ğŸ“ˆ ç©å®¶ä¸ªäººåŠ æˆ (x%)",
                th_troop: "å…µç§",
                th_buff_atk: "åŠ æˆæ”» (%)",
                th_buff_leth: "åŠ æˆæ€ (%)",
                troop_inf: "ğŸ›¡ï¸ ç›¾å…µ",
                troop_rid: "ğŸ éª‘å…µ",
                troop_hun: "ğŸ¹ å¼“å…µ",
                btn_calc: "ç”Ÿæˆè®¡ç®—ç»“æœ",
                result_title: "ğŸ“Š æ¨èé…å…µæ–¹æ¡ˆ"
            },
            "en": {
                title: "Bear Trap Calculator V4.0",
                config_title: "ğŸ› ï¸ Basic Configuration",
                label_capacity: "March Capacity:",
                label_tier: "Gold Skill Tier:",
                label_rosa: "Use Rosa (Archer Atk x1.3)",
                label_shield_limit: "Infantry Min 5,000",
                opt_none: "Standard / < Gold 3",
                opt_g3: "Gold 3 (1.1x Dmg)",
                opt_g5: "Gold 5 (1.15x Dmg)",
                opt_g8: "Gold 8 (Archer Spec)",
                stats_title: "ğŸ“ˆ Personal Stats (x%)",
                th_troop: "Type",
                th_buff_atk: "Atk Bonus (%)",
                th_buff_leth: "Leth Bonus (%)",
                troop_inf: "ğŸ›¡ï¸ Infantry",
                troop_rid: "ğŸ Cavalry",
                troop_hun: "ğŸ¹ Archer",
                btn_calc: "Calculate Result",
                result_title: "ğŸ“Š Recommended Formation"
            }
        };

        let currentLang = "zh-CN";

        function changeLanguage(lang) {
            currentLang = lang;
            const t = translations[lang];
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (t[key]) el.textContent = t[key];
            });
        }

        function calculate() {
            const cap = parseFloat(document.getElementById('totalCapacity').value) || 0;
            const tier = document.getElementById('heroTier').value;
            const useRosa = document.getElementById('useRosa').checked;
            const useShieldLimit = document.getElementById('useShieldLimit').checked;

            if (cap <= 0) return alert("Please enter capacity");

            const getVal = (id) => parseFloat(document.getElementById(id).value) || 0;
            
            // åŸºç¡€æ”»å‡»åŠ›ç³»æ•°
            const base = { inf: 1, rid: 3, hun: 4 };

            // 1. ç›¾å…µå¼ºåº¦ S_inf
            let s_inf = (1 + getVal('inf_atk')/100) * (1 + getVal('inf_leth')/100) * base.inf;

            // 2. éª‘å…µå¼ºåº¦ S_rid
            let ridSkill = (tier === 'g3') ? 1.1 : (tier === 'g5' || tier === 'g8') ? 1.15 : 1.0;
            let s_rid = (1 + getVal('rid_atk')/100) * (1 + getVal('rid_leth')/100) * base.rid * ridSkill;

            // 3. å¼“å…µå¼ºåº¦ S_hun
            let hunSkill = 1.21; // å›ºæœ‰è¢«åŠ¨
            let hunAtkBonus = getVal('hun_atk');
            if (tier === 'g3') hunSkill *= 1.1;
            else if (tier === 'g5') hunSkill *= 1.15;
            else if (tier === 'g8') { hunSkill *= 1.225; hunAtkBonus += 4; }

            // ç½—èåŠ æˆé€»è¾‘ï¼š(1 + x%) * 1.3
            let hunAtkFactor = (1 + hunAtkBonus/100);
            if (useRosa) hunAtkFactor *= 1.3;

            let s_hun = hunAtkFactor * (1 + getVal('hun_leth')/100) * base.hun * hunSkill;

            // æƒé‡ W = S^2
            const w_inf = s_inf ** 2;
            const w_rid = s_rid ** 2;
            const w_hun = s_hun ** 2;
            const totalW = w_inf + w_rid + w_hun;

            let finalInf, finalRid, finalHun;

            if (useShieldLimit) {
                finalInf = Math.min(cap, 5000);
                let rem = cap - finalInf;
                let subW = w_rid + w_hun;
                finalRid = Math.round(rem * (w_rid / subW));
                finalHun = rem - finalRid;
            } else {
                finalInf = Math.round(cap * (w_inf / totalW));
                finalRid = Math.round(cap * (w_rid / totalW));
                finalHun = cap - finalInf - finalRid;
            }

            // UI æ¸²æŸ“
            const t = translations[currentLang];
            document.getElementById('result-area').style.display = 'block';
            document.getElementById('result-content').innerHTML = `
                <div class="result-row"><span>${t.troop_inf}</span> <span><span class="result-highlight">${finalInf.toLocaleString()}</span> (${((finalInf/cap)*100).toFixed(1)}%)</span></div>
                <div class="result-row"><span>${t.troop_rid}</span> <span><span class="result-highlight">${finalRid.toLocaleString()}</span> (${((finalRid/cap)*100).toFixed(1)}%)</span></div>
                <div class="result-row"><span>${t.troop_hun}</span> <span><span class="result-highlight">${finalHun.toLocaleString()}</span> (${((finalHun/cap)*100).toFixed(1)}%)</span></div>
                <div style="font-size:0.85em; color:#888; margin-top:15px; text-align:right;">
                    * è®¡ç®—åŸºäºæ‹‰æ ¼æœ—æ—¥ä¹˜æ•°æ³•æå€¼é€»è¾‘ (SÂ² æƒé‡åˆ†é…)
                </div>
            `;
        }
    </script>
</body>
</html>
