<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bear Trap Calculator - Pro</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f4f4f9; color: #333; padding: 20px; max-width: 800px; margin: 0 auto; }
        .lang-container { text-align: right; margin-bottom: 10px; }
        h1 { text-align: center; color: #2c3e50; }
        .card { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .section-title { font-weight: bold; margin-bottom: 15px; border-bottom: 2px solid #eee; padding-bottom: 5px; color: #555; }
        .input-group { display: flex; gap: 15px; margin-bottom: 15px; align-items: center; flex-wrap: wrap; }
        .input-group label { font-weight: bold; min-width: 130px; }
        input[type="number"], select { padding: 8px; border: 1px solid #ccc; border-radius: 4px; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { padding: 8px; text-align: center; border-bottom: 1px solid #eee; }
        th { background-color: #f8f9fa; }
        .btn-calc { width: 100%; padding: 15px; background-color: #e67e22; color: white; border: none; border-radius: 6px; font-size: 18px; cursor: pointer; transition: 0.3s; }
        .btn-calc:hover { background-color: #d35400; }
        #result-area { display: none; background-color: #fef5e7; border: 1px solid #f5b041; padding: 20px; border-radius: 8px; }
        .result-row { display: flex; justify-content: space-between; margin-bottom: 10px; font-size: 1.1em; border-bottom: 1px dashed #f5b041; padding-bottom: 5px; }
        .result-highlight { font-weight: bold; color: #d35400; }
        .notice { font-size: 0.85em; color: #7f8c8d; margin-top: 10px; font-style: italic; }
    </style>
</head>
<body>

    <div class="lang-container">
        <select id="langSelector" onchange="changeLanguage(this.value)">
            <option value="zh-CN">ç®€ä½“ä¸­æ–‡</option>
            <option value="en">English</option>
        </select>
    </div>

    <h1 data-i18n="title">ğŸ» æ‰“ç†Šé…å…µæ¯”ä¾‹è®¡ç®—å™¨</h1>
    
    <div class="card">
        <div class="section-title" data-i18n="config_title">æˆ˜æœ¯é…ç½®</div>
        <div class="input-group">
            <label data-i18n="label_capacity">å‡ºå¾å®¹é‡ï¼š</label>
            <input type="number" id="totalCapacity" value="160000">
        </div>

        <div class="input-group">
            <label data-i18n="label_tier">è‹±é›„å…µç§ç­‰çº§ï¼š</label>
            <select id="heroTier" class="tier-select" style="min-width: 200px;">
                <option value="none" data-i18n="opt_none">æ™®é€š (ä½äºé»„é‡‘3)</option>
                <option value="g3" data-i18n="opt_g3">é»„é‡‘ 3 (æŠ€èƒ½ 1.1x)</option>
                <option value="g5" data-i18n="opt_g5">é»„é‡‘ 5 (æŠ€èƒ½ 1.15x)</option>
                <option value="g8" data-i18n="opt_g8">é»„é‡‘ 8 (å¼“å…µ 1.225x + 4%æ”»)</option>
            </select>
        </div>
    </div>

    <div class="card">
        <div class="section-title" data-i18n="stats_title">ä¸ªäººåŠ æˆæ•°å€¼ (x)</div>
        <table>
            <thead>
                <tr>
                    <th data-i18n="th_troop">å…µç§</th>
                    <th data-i18n="th_buff_atk">åŠ æˆæ”» (%)</th>
                    <th data-i18n="th_buff_leth">åŠ æˆæ€ (%)</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td data-i18n="troop_inf">ğŸ›¡ï¸ ç›¾å…µ</td>
                    <td><input type="number" id="inf_atk" value="400"></td>
                    <td><input type="number" id="inf_leth" value="400"></td>
                </tr>
                <tr>
                    <td data-i18n="troop_rid">ğŸ éª‘å…µ</td>
                    <td><input type="number" id="rid_atk" value="400"></td>
                    <td><input type="number" id="rid_leth" value="400"></td>
                </tr>
                <tr>
                    <td data-i18n="troop_hun">ğŸ¹ å¼“å…µ</td>
                    <td><input type="number" id="hun_atk" value="400"></td>
                    <td><input type="number" id="hun_leth" value="400"></td>
                </tr>
            </tbody>
        </table>

        <button class="btn-calc" onclick="calculate()" style="margin-top: 20px;" data-i18n="btn_calc">ç”Ÿæˆæœ€ä¼˜é…å…µæ–¹æ¡ˆ</button>
    </div>

    <div class="card" id="result-area">
        <div class="section-title" data-i18n="result_title">âš–ï¸ æ¨èå‡ºå¾æ–¹æ¡ˆ</div>
        <div id="result-content"></div>
        <div class="notice" data-i18n="msg_correction">* ç›¾å…µå·²è‡ªåŠ¨è¡¥é½æœ€ä½ 5,000 ä»¥å¸æ”¶ä¼¤å®³ã€‚</div>
    </div>

    <script>
        const translations = {
            "zh-CN": {
                title: "ğŸ» æ‰“ç†Šé…å…µæ¯”ä¾‹è®¡ç®—å™¨",
                config_title: "æˆ˜æœ¯ä¸ç­‰çº§é…ç½®",
                label_capacity: "å‡ºå¾å®¹é‡ï¼š",
                label_tier: "é»„é‡‘æŠ€èƒ½é˜¶æ®µï¼š",
                opt_none: "æ™®é€š / ä½äºé»„é‡‘3",
                opt_g3: "é»„é‡‘ 3 (1.1x å¢ä¼¤)",
                opt_g5: "é»„é‡‘ 5 (1.15x å¢ä¼¤)",
                opt_g8: "é»„é‡‘ 8 (å¼“å…µç‰¹å¼º)",
                stats_title: "é¢æ¿åŠ æˆæ•°æ®",
                th_troop: "å…µç§",
                th_buff_atk: "åŠ æˆæ”» (%)",
                th_buff_leth: "åŠ æˆæ€ (%)",
                troop_inf: "ğŸ›¡ï¸ ç›¾å…µ",
                troop_rid: "ğŸ éª‘å…µ",
                troop_hun: "ğŸ¹ å¼“å…µ",
                btn_calc: "è®¡ç®—æœ€ä½³æ¯”ä¾‹",
                result_title: "âš–ï¸ æœ€ä½³é…å…µæ–¹æ¡ˆ",
                msg_correction: "* ç›¾å…µå·²è¡¥é½ 5000 (æ¸¸æˆæœºåˆ¶éœ€è¦)ï¼Œå…¶ä½™æŒ‰æƒé‡åˆ†é…ã€‚"
            },
            "en": {
                title: "Bear Trap Calculator",
                config_title: "Tactics & Tier",
                label_capacity: "March Capacity:",
                label_tier: "Hero Skill Tier:",
                opt_none: "Standard / < Gold 3",
                opt_g3: "Gold 3 (1.1x Dmg)",
                opt_g5: "Gold 5 (1.15x Dmg)",
                opt_g8: "Gold 8 (Archer Spec)",
                stats_title: "Your Bonus Stats",
                th_troop: "Type",
                th_buff_atk: "Atk Bonus (%)",
                th_buff_leth: "Leth Bonus (%)",
                troop_inf: "ğŸ›¡ï¸ Infantry",
                troop_rid: "ğŸ Cavalry",
                troop_hun: "ğŸ¹ Archer",
                btn_calc: "Calculate Best Ratio",
                result_title: "âš–ï¸ Optimal Formation",
                msg_correction: "* Infantry adjusted to 5,000 min; others by weight."
            }
        };

        let currentLang = "zh-CN";

        function changeLanguage(lang) {
            currentLang = lang;
            const t = translations[lang];
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (t[key]) el.textContent = t[key];
            });
        }

        function calculate() {
            const cap = parseFloat(document.getElementById('totalCapacity').value) || 0;
            const tier = document.getElementById('heroTier').value;
            
            // åŸºç¡€å±æ€§ (N=1)
            const base = { inf: 1, rid: 3, hun: 4 };
            
            // è·å–åŠ æˆ
            const stats = {
                infAtk: parseFloat(document.getElementById('inf_atk').value) || 0,
                infLeth: parseFloat(document.getElementById('inf_leth').value) || 0,
                ridAtk: parseFloat(document.getElementById('rid_atk').value) || 0,
                ridLeth: parseFloat(document.getElementById('rid_leth').value) || 0,
                hunAtk: parseFloat(document.getElementById('hun_atk').value) || 0,
                hunLeth: parseFloat(document.getElementById('hun_leth').value) || 0
            };

            // è®¡ç®—å„å…µç§å•å…µå¼ºåº¦ S
            // ç›¾å…µ S
            let s_inf = (1 + stats.infAtk/100) * (1 + stats.infLeth/100) * base.inf;

            // éª‘å…µ S
            let ridSkill = 1.0;
            if (tier === 'g3') ridSkill = 1.1;
            else if (tier === 'g5' || tier === 'g8') ridSkill = 1.15;
            let s_rid = (1 + stats.ridAtk/100) * (1 + stats.ridLeth/100) * base.rid * ridSkill;

            // å¼“å…µ S
            let hunSkill = 1.21; // å›ºæœ‰è¢«åŠ¨
            let hunAtkBonus = stats.hunAtk;
            if (tier === 'g3') hunSkill *= 1.1;
            else if (tier === 'g5') hunSkill *= 1.15;
            else if (tier === 'g8') {
                hunSkill *= 1.225;
                hunAtkBonus += 4; // é»„é‡‘8 é¢å¤– 4% æ”»å‡»
            }
            let s_hun = (1 + hunAtkBonus/100) * (1 + stats.hunLeth/100) * base.hun * hunSkill;

            // æƒé‡ W = S^2
            const w_inf = s_inf ** 2;
            const w_rid = s_rid ** 2;
            const w_hun = s_hun ** 2;
            const totalW = w_inf + w_rid + w_hun;

            // åˆ†é…é€»è¾‘
            let finalInf = 5000; 
            let remaining = cap - finalInf;
            if (remaining < 0) { finalInf = cap; remaining = 0; }

            const subTotalW = w_rid + w_hun;
            let finalRid = Math.round(remaining * (w_rid / subTotalW));
            let finalHun = remaining - finalRid;

            // æ¸²æŸ“ç»“æœ
            const t = translations[currentLang];
            document.getElementById('result-area').style.display = 'block';
            document.getElementById('result-content').innerHTML = `
                <div class="result-row"><span>${t.troop_inf}</span> <span><span class="result-highlight">${finalInf.toLocaleString()}</span> (${((finalInf/cap)*100).toFixed(1)}%)</span></div>
                <div class="result-row"><span>${t.troop_rid}</span> <span><span class="result-highlight">${finalRid.toLocaleString()}</span> (${((finalRid/cap)*100).toFixed(1)}%)</span></div>
                <div class="result-row"><span>${t.troop_hun}</span> <span><span class="result-highlight">${finalHun.toLocaleString()}</span> (${((finalHun/cap)*100).toFixed(1)}%)</span></div>
            `;
        }
    </script>
</body>
</html>
